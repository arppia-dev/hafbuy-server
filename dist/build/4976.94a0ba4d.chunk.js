"use strict";(self.webpackChunke_commerce_server=self.webpackChunke_commerce_server||[]).push([[4976],{44976:(Es,z,s)=>{s.d(z,{ReviewWorkflowsCreatePage:()=>q});var t=s(19968),i=s(62552),k=s(51772),h=s(1560),N=s(33560),I=s(65080),E=s(71812),Y=s(18520),Q=s(78164),L=s(31812),V=s(35184),H=s(14632),Z=s(48632),d=s(70516),$=s(49008),G=s(68940),J=s(50040),e=s(69600),X=s(17072),D=s(35180),r=s(74556),P=s(48132),b=s(30320),ds=s(38188),Ms=s(54320),Os=s(5240),Ds=s(91892),Ps=s(36196),gs=s(20880),fs=s(21424),cs=s(18424),ms=s(52540),vs=s(21968),hs=s(12132),Ls=s(85676),Cs=s(99568),Ts=s(96556),Rs=s(13192),Ws=s(30840),As=s(77784),Is=s(79371),Bs=s(67888),Us=s(52600),Ks=s(95752),us=s(37388),ws=s(61840),ys=s(49108),js=s(44632),xs=s(50840),ps=s(20252),Ss=s(86432),Fs=s(22612),zs=s(24808),ks=s(24024),Ns=s(33656),Ys=s(43280),Qs=s(79804),Vs=s(19632),Hs=s(29576),Zs=s(61152),$s=s(9589),Gs=s(45488),Js=s(75516),Xs=s(8800);const q=()=>{const{formatMessage:a}=(0,H.c)(),{post:ss}=(0,E.Qn)(),{push:ts}=(0,$.Uz)(),{formatAPIError:os}=(0,E.An)(),l=(0,d.OY)(),g=(0,E.eo)(),{collectionTypes:B,singleTypes:U,isLoading:C}=(0,J.u)(),{isLoading:f,meta:K,workflows:c}=(0,b.u)(),{isLoading:T,roles:u}=(0,G.u)(void 0,{retry:!1}),m=(0,d.w1)(e.s),es=(0,d.w1)(e.a),n=(0,d.w1)(e.b),w=(0,d.w1)(e.c),[y,M]=i.useState(null),{isLoading:j,getFeature:as}=(0,X.u)(),[ns,_s]=i.useState(),[x,R]=i.useState({}),v=as("review-workflows"),p=v?.[P.C],O=v?.[P.a],S=c?.flatMap(o=>o.contentTypes),{mutateAsync:ls}=(0,Z.useMutation)(async({workflow:o})=>{const{data:{data:_}}=await ss("/admin/review-workflows/workflows",{data:o});return _},{onSuccess(){g({type:"success",message:{id:"Settings.review-workflows.create.page.notification.success",defaultMessage:"Workflow successfully created"}})}}),F=async()=>{R({});try{const o=await ls({workflow:n});return ts(`/settings/review-workflows/${o.id}`),o}catch(o){if(o instanceof Q.Uh)return o.response?.data?.error?.name==="ValidationError"&&o.response?.data?.error?.details?.errors?.length>0&&_s((o.response?.data?.error?.details?.errors).reduce((_,A)=>(A.path&&V(_,A.path,A.message),_),{})),g({type:"warning",message:os(o)}),null}},is=async()=>{await F()},rs=()=>{R({})},W=(0,L.KO)({enableReinitialize:!0,initialErrors:ns,initialValues:n,async onSubmit(){const o=n.contentTypes?.some(_=>S?.includes(_));K&&p&&K?.workflowCount>=parseInt(p,10)?M("workflow"):n.stages&&O&&n.stages.length>=parseInt(O,10)?M("stage"):o?R(_=>({..._,hasReassignedContentTypes:!0})):F()},validate(o){return(0,e.v)({values:o,formatMessage:a})}});return(0,e.u)(P.R,e.i),i.useEffect(()=>{l((0,e.r)()),!f&&c&&l((0,e.d)({workflows:c})),C||l((0,e.e)({collectionTypes:B,singleTypes:U})),T||l((0,e.f)(u)),l((0,e.g)(C||T)),l((0,e.h)({name:""}))},[B,l,C,T,f,u,U,c]),i.useEffect(()=>{!f&&!j&&n.stages&&v?.[P.a]&&O&&n.stages.length>=parseInt(O,10)&&M("stage")},[j,f,v,n.stages,O]),i.useEffect(()=>{!m&&w?.length===0&&g({blockTransition:!0,type:"warning",message:a({id:"Settings.review-workflows.stage.permissions.noPermissions.description",defaultMessage:"You don\u2019t have the permission to see roles"})})},[a,m,w,g]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(D.D,{}),(0,t.jsx)(L.uo,{value:W,children:(0,t.jsxs)(L.QF,{onSubmit:W.handleSubmit,children:[(0,t.jsx)(D.H,{navigationAction:(0,t.jsx)(D.B,{href:"/settings/review-workflows"}),primaryAction:(0,t.jsx)(k.Z,{startIcon:(0,t.jsx)(Y.c,{}),type:"submit",size:"M",disabled:!es,children:a({id:"global.save",defaultMessage:"Save"})}),title:a({id:"Settings.review-workflows.create.page.title",defaultMessage:"Create Review Workflow"}),subtitle:a({id:"Settings.review-workflows.page.subtitle",defaultMessage:"{count, plural, one {# stage} other {# stages}}"},{count:n?.stages?.length??0})}),(0,t.jsx)(D.R,{children:(0,t.jsx)(h.C,{alignItems:"stretch",direction:"column",gap:7,children:m?(0,t.jsx)(N.c,{children:a({id:"Settings.review-workflows.page.isLoading",defaultMessage:"Workflow is loading"})}):(0,t.jsxs)(h.C,{alignItems:"stretch",direction:"column",gap:7,children:[(0,t.jsx)(e.W,{}),(0,t.jsx)(e.S,{stages:W.values?.stages})]})})})]})}),(0,t.jsx)(E.cz.Root,{isConfirmButtonLoading:m,isOpen:Object.keys(x).length>0,onToggleDialog:rs,onConfirm:is,children:(0,t.jsx)(E.cz.Body,{children:(0,t.jsxs)(h.C,{direction:"column",gap:5,children:[x.hasReassignedContentTypes&&(0,t.jsx)(I.O,{textAlign:"center",variant:"omega",children:a({id:"Settings.review-workflows.page.delete.confirm.contentType.body",defaultMessage:"{count} {count, plural, one {content-type} other {content-types}} {count, plural, one {is} other {are}} already mapped to {count, plural, one {another workflow} other {other workflows}}. If you save changes, {count, plural, one {this} other {these}} {count, plural, one {content-type} other {{count} content-types}} will no more be mapped to the {count, plural, one {another workflow} other {other workflows}} and all corresponding information will be removed."},{count:S?.filter(o=>n.contentTypes?.includes(o)).length})}),(0,t.jsx)(I.O,{textAlign:"center",variant:"omega",children:a({id:"Settings.review-workflows.page.delete.confirm.confirm",defaultMessage:"Are you sure you want to save?"})})]})})}),(0,t.jsxs)(r.L.Root,{isOpen:y==="workflow",onClose:()=>M(null),children:[(0,t.jsx)(r.L.Title,{children:a({id:"Settings.review-workflows.create.page.workflows.limit.title",defaultMessage:"You\u2019ve reached the limit of workflows in your plan"})}),(0,t.jsx)(r.L.Body,{children:a({id:"Settings.review-workflows.create.page.workflows.limit.body",defaultMessage:"Delete a workflow or contact Sales to enable more workflows."})})]}),(0,t.jsxs)(r.L.Root,{isOpen:y==="stage",onClose:()=>M(null),children:[(0,t.jsx)(r.L.Title,{children:a({id:"Settings.review-workflows.create.page.stages.limit.title",defaultMessage:"You have reached the limit of stages for this workflow in your plan"})}),(0,t.jsx)(r.L.Body,{children:a({id:"Settings.review-workflows.create.page.stages.limit.body",defaultMessage:"Try deleting some stages or contact Sales to enable more stages."})})]})]})}}}]);
