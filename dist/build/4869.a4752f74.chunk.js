"use strict";(self.webpackChunke_commerce_server=self.webpackChunke_commerce_server||[]).push([[4869],{74869:(_s,x,s)=>{s.d(x,{M:()=>p,ProtectedEditView:()=>J});var n=s(19968),I=s(62552),U=s(8612),K=s(41868),R=s(1560),S=s(84664),k=s(65080),N=s(23128),g=s(11360),F=s(37272),Q=s(51772),e=s(71812),V=s(18520),C=s(78164),G=s(31812),h=s(14632),z=s(48632),B=s(70516),L=s(49008),O=s(52540),W=s(9252),Y=s(71944),v=s(63648),d=s(98790),Es=s(17892),ds=s(31212),ls=s(38188),Ms=s(54320),Ps=s(5240),Os=s(91892),Ds=s(36196),ms=s(20880),Ts=s(21424),cs=s(18424),fs=s(21968),gs=s(12132),vs=s(85676),As=s(35184),Cs=s(99568),hs=s(96556),Ls=s(13192),Is=s(30840),Us=s(77784),Ks=s(79371),Rs=s(67888),Bs=s(52600),Ws=s(95752),ps=s(37388),us=s(61840),ys=s(49108),js=s(44632),xs=s(50840),Ss=s(20252),ks=s(86432),Ns=s(22612),Fs=s(24808),Qs=s(24024),Vs=s(33656),Gs=s(43280),zs=s(79804),Ys=s(19632),$s=s(29576),Hs=s(61152),Js=s(9589),Zs=s(45488),Xs=s(75516);const $=O.kt().shape({name:O.Qb().max(100).required(e.aO.required),description:O.Qb().nullable(),lifespan:O.CQ().integer().min(0).nullable().defined(e.aO.required),permissions:O.Qb().required(e.aO.required)}),H="Name already taken",p=()=>{(0,e.G0)();const{formatMessage:i}=(0,h.c)(),{lockApp:E,unlockApp:l}=(0,e.H6)(),_=(0,e.eo)(),M=(0,L.Uz)(),{state:D}=(0,L.IT)(),[o,m]=I.useState(D&&"accessKey"in D.transferToken?{...D.transferToken}:null),{trackUsage:P}=(0,e.m4)(),{setCurrentStep:w}=(0,e.sg)(),b=(0,B.w1)(W.s),{allowedActions:{canCreate:q,canUpdate:ss,canRegenerate:ns}}=(0,e.aU)(b.settings["transfer-tokens"]),ts=(0,L.SU)("/settings/transfer-tokens/:id"),{get:as,post:es,put:os}=(0,e.Qn)(),A=ts?.params?.id,r=A==="create",{formatAPIError:u}=(0,e.An)();I.useEffect(()=>{P(r?"didAddTokenFromList":"didEditTokenFromList",{tokenType:v.T})},[r,P]),(0,z.useQuery)(["transfer-token",A],async()=>{const{data:{data:t}}=await as(`/admin/transfer/tokens/${A}`);return m({...t}),t},{enabled:!r&&!o,onError(t){t instanceof C.Uh&&(t.response.data.error.details?.code==="INVALID_TOKEN_SALT"?_({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):_({type:"warning",message:u(t)}))}});const rs=async(t,T)=>{P(r?"willCreateToken":"willEditToken",{tokenType:v.T}),E();const c=t.permissions.split("-");if((a=>a.length===1?a[0]==="push"||a[0]==="pull":a[0]==="push"&&a[1]==="pull")(c))try{let a;if(r){const{data:f}=await es("/admin/transfer/tokens",{...t,permissions:c});a=f.data}else{const{data:f}=await os(`/admin/transfer/tokens/${A}`,{name:t.name,description:t.description,permissions:c});a=f.data}l(),r&&(M.replace(`/settings/transfer-tokens/${a.id}`,{transferToken:a}),w("transferTokens.success")),m({...a}),_({type:"success",message:i(r?{id:"notification.success.transfertokencreated",defaultMessage:"Transfer Token successfully created"}:{id:"notification.success.transfertokenedited",defaultMessage:"Transfer Token successfully edited"})}),P(r?"didCreateToken":"didEditToken",{type:o?.permissions,tokenType:v.T})}catch(a){if(a instanceof C.Uh){const f=(0,Y.f)(a.response.data);T.setErrors(f),a?.response?.data?.error?.message===H?_({type:"warning",message:a.response.data.message||"notification.error.tokennamenotunique"}):a?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?_({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):_({type:"warning",message:a?.response?.data?.message||"notification.error"})}l()}},y=ss&&!r||q&&r;if(!r&&!o)return(0,n.jsx)(X,{});const is=t=>{t instanceof C.Uh&&(t?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?_({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):_({type:"warning",message:u(t)}))};return(0,n.jsxs)(U.G,{children:[(0,n.jsx)(e.K8,{name:"Transfer Tokens"}),(0,n.jsx)(G.QJ,{validationSchema:$,validateOnChange:!1,initialValues:{name:o?.name||"",description:o?.description||"",lifespan:o?.lifespan??null,permissions:o?.permissions.join("-")??""},enableReinitialize:!0,onSubmit:(t,T)=>rs(t,T),children:({errors:t,handleChange:T,isSubmitting:c,values:j})=>(0,n.jsxs)(e.QF,{children:[(0,n.jsx)(d.F,{backUrl:"/settings/transfer-tokens",title:{id:"Settings.transferTokens.createPage.title",defaultMessage:"TokenCreate Transfer Token"},token:o,setToken:m,canEditInputs:y,canRegenerate:ns,isSubmitting:c,regenerateUrl:"/admin/transfer/tokens/",onErrorRegenerate:is}),(0,n.jsx)(K.S,{children:(0,n.jsxs)(R.C,{direction:"column",alignItems:"stretch",gap:6,children:[o&&Boolean(o?.name)&&"accessKey"in o&&(0,n.jsx)(d.c,{token:o.accessKey,tokenType:v.T}),(0,n.jsx)(Z,{errors:t,onChange:T,canEditInputs:y,isCreating:r,values:j,transferToken:o})]})})]})})]})},J=()=>{const i=(0,B.w1)(W.s);return(0,n.jsx)(e.rF,{permissions:i.settings?.["transfer-tokens"].read,children:(0,n.jsx)(p,{})})},Z=({errors:i={},onChange:E,canEditInputs:l,isCreating:_,values:M,transferToken:D={}})=>{const{formatMessage:o}=(0,h.c)(),m=[{value:"push",label:{id:"Settings.transferTokens.types.push",defaultMessage:"Push"}},{value:"pull",label:{id:"Settings.transferTokens.types.pull",defaultMessage:"Pull"}},{value:"push-pull",label:{id:"Settings.transferTokens.types.push-pull",defaultMessage:"Full Access"}}];return(0,n.jsx)(S.k,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,n.jsxs)(R.C,{direction:"column",alignItems:"stretch",gap:4,children:[(0,n.jsx)(k.O,{variant:"delta",as:"h2",children:o({id:"global.details",defaultMessage:"Details"})}),(0,n.jsxs)(N.y,{gap:5,children:[(0,n.jsx)(g.C,{col:6,xs:12,children:(0,n.jsx)(d.T,{error:i.name,value:M.name,canEditInputs:l,onChange:E})},"name"),(0,n.jsx)(g.C,{col:6,xs:12,children:(0,n.jsx)(d.a,{error:i.description,value:M.description,canEditInputs:l,onChange:E})},"description"),(0,n.jsx)(g.C,{col:6,xs:12,children:(0,n.jsx)(d.L,{isCreating:_,error:i.lifespan,value:M.lifespan,onChange:E,token:D})},"lifespan"),(0,n.jsx)(g.C,{col:6,xs:12,children:(0,n.jsx)(d.b,{name:"permissions",value:M.permissions,error:i.permissions,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:P=>{E({target:{name:"permissions",value:P}})},options:m,canEditInputs:l})},"permissions")]})]})})},X=({transferTokenName:i})=>{const{formatMessage:E}=(0,h.c)();return(0,e.G0)(),(0,n.jsxs)(U.G,{"aria-busy":"true",children:[(0,n.jsx)(e.K8,{name:"Transfer Tokens"}),(0,n.jsx)(F.a,{primaryAction:(0,n.jsx)(Q.Z,{disabled:!0,startIcon:(0,n.jsx)(V.c,{}),type:"button",size:"L",children:E({id:"global.save",defaultMessage:"Save"})}),title:i||E({id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"})}),(0,n.jsx)(K.S,{children:(0,n.jsx)(e.Wm,{})})]})}}}]);
