"use strict";(self.webpackChunke_commerce_server=self.webpackChunke_commerce_server||[]).push([[9229],{69229:($,C,t)=>{t.r(C),t.d(C,{InformationBoxEE:()=>k});var s=t(19968),a=t(71812),r=t(38188),R=t(91328),l=t(1560),B=t(66216),u=t(12192),m=t(48816),U=t(65080),G=t(33560),H=t(6140),V=t(32576),F=t(14632),x=t(48632),o=t(41864),S=t(62552),z=t(17072),v=t(74556),K=t(48132),Q=t(8800),b=t(54320),q=t(5240),tt=t(91892),st=t(36196),at=t(20880),et=t(21424),nt=t(70516),ot=t(31812),_t=t(18424),lt=t(52540),it=t(21968),rt=t(12132),Et=t(85676),dt=t(35184),Mt=t(99568),gt=t(96556),Ot=t(13192),mt=t(30840),Dt=t(77784),Pt=t(79371),ct=t(67888),ht=t(52600),Ct=t(95752),vt=t(37388),At=t(61840),It=t(49108),Lt=t(44632),ut=t(50840),Wt=t(20252),ft=t(86432),Tt=t(22612),Rt=t(24808),Bt=t(24024),Ut=t(33656),Kt=t(43280),yt=t(79804),jt=t(19632),xt=t(29576),St=t(61152),pt=t(9589),wt=t(45488),Nt=t(75516);const J=()=>{const{initialData:_,layout:E,isSingleType:D,onChange:W}=(0,a.O_)(),A=(0,r.f)(n=>n.admin_app.permissions),{formatMessage:e}=(0,F.c)(),{formatAPIError:f}=(0,a.An)(),M=(0,a.eo)(),{put:T}=(0,a.Qn)(),{allowedActions:{canRead:d},isLoading:P}=(0,a.aU)(A.settings?.users),{users:I,isLoading:L,isError:y}=(0,r.g)({},{enabled:!P&&d}),c=_?.[o.A]??null,h=async n=>{i.mutate({entityId:_.id,assigneeId:n?parseInt(n,10):null,uid:E.uid})},i=(0,x.useMutation)(async({entityId:n,assigneeId:p,uid:w})=>{const g=D?"single-types":"collection-types",{data:{data:O}}=await T(`/admin/content-manager/${g}/${w}/${n}/assignee`,{data:{id:p}});return W?.({target:{type:"",name:o.A,value:O[o.A]}},!0),O},{onSuccess(){M({type:"success",message:{id:"content-manager.reviewWorkflows.assignee.notification.saved",defaultMessage:"Assignee updated"}})}});return(0,s.jsx)(R.I,{name:o.A,id:o.A,children:(0,s.jsx)(l.C,{direction:"column",gap:2,alignItems:"stretch",children:(0,s.jsx)(B.k1,{clearLabel:e({id:"content-manager.reviewWorkflows.assignee.clear",defaultMessage:"Clear assignee"}),error:(y&&d&&e({id:"content-manager.reviewWorkflows.assignee.error",defaultMessage:"An error occurred while fetching users"})||i.error&&f(i.error))??void 0,disabled:!P&&!L&&I.length===0,name:o.A,id:o.A,value:c?c.id.toString():null,onChange:h,onClear:()=>h(null),placeholder:e({id:"content-manager.reviewWorkflows.assignee.placeholder",defaultMessage:"Select \u2026"}),label:e({id:"content-manager.reviewWorkflows.assignee.label",defaultMessage:"Assignee"}),loading:L||P||i.isLoading,children:I.map(n=>(0,s.jsx)(u.m,{value:n.id.toString(),textValue:(0,r.h)(n,e),children:(0,r.h)(n,e)},n.id))})})})};function X({id:_,layout:E},D={}){const{kind:W,uid:A}=E,e=W==="collectionType"?"collection-types":"single-types",{get:f}=(0,a.Qn)(),{data:M,isLoading:T,refetch:d}=(0,x.useQuery)(["content-manager",e,A,_,"stages"],async()=>{const{data:L}=await f(`/admin/content-manager/${e}/${A}/${_}/stages`);return L},D),P=S.useMemo(()=>M?.meta??{workflowCount:0},[M?.meta]),I=S.useMemo(()=>M?.data??[],[M?.data]);return{meta:P,stages:I,isLoading:T,refetch:d}}const Z=()=>{const{initialData:_,layout:E,isSingleType:D,onChange:W}=(0,a.O_)(),{put:A}=(0,a.Qn)(),{formatMessage:e}=(0,F.c)(),{formatAPIError:f}=(0,a.An)(),M=(0,a.eo)(),{meta:T,stages:d,isLoading:P,refetch:I}=X({id:_.id,layout:E},{enabled:!!_?.id}),{getFeature:L}=(0,z.u)(),[y,c]=S.useState(null),h=L("review-workflows")??{},i=_?.[o.S]??null,n=(0,x.useMutation)(async({entityId:g,stageId:O,uid:j})=>{const N=D?"single-types":"collection-types",{data:{data:Y}}=await A(`/admin/content-manager/${N}/${j}/${g}/stage`,{data:{id:O}});return W?.({target:{name:o.S,value:Y[o.S],type:""}},!0),await I(),Y},{onSuccess(){M({type:"success",message:{id:"content-manager.reviewWorkflows.stage.notification.saved",defaultMessage:"Review stage updated"}})}}),p=async g=>{try{h?.[K.C]&&parseInt(h[K.C],10)<T.workflowCount?c("workflow"):h?.[K.a]&&parseInt(h[K.a],10)<d.length?c("stage"):_.id&&E&&n.mutateAsync({entityId:_.id,stageId:g,uid:E.uid})}catch{}},{themeColorName:w}=(0,Q.g)(i?.color)??{};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(R.I,{hint:d.length===0&&e({id:"content-manager.reviewWorkflows.stages.no-transition",defaultMessage:"You don\u2019t have the permission to update this stage."}),name:o.S,id:o.S,children:(0,s.jsxs)(l.C,{direction:"column",gap:2,alignItems:"stretch",children:[(0,s.jsx)(m.K_,{disabled:d.length===0,error:n.error&&f(n.error)||void 0,name:o.S,id:o.S,value:i?.id,onChange:p,label:e({id:"content-manager.reviewWorkflows.stage.label",defaultMessage:"Review stage"}),startIcon:i&&(0,s.jsx)(l.C,{as:"span",height:2,background:i?.color,borderColor:w==="neutral0"?"neutral150":void 0,hasRadius:!0,shrink:0,width:2,marginRight:"-3px"}),customizeContent:()=>(0,s.jsxs)(l.C,{as:"span",justifyContent:"space-between",alignItems:"center",width:"100%",children:[(0,s.jsx)(U.O,{textColor:"neutral800",ellipsis:!0,children:i?.name??""}),P?(0,s.jsx)(G.c,{small:!0,style:{display:"flex"},"data-testid":"loader"}):null]}),children:d.map(({id:g,color:O,name:j})=>{const{themeColorName:N}=(0,Q.g)(O)??{};return(0,s.jsx)(m.kH,{startIcon:(0,s.jsx)(l.C,{height:2,background:O,borderColor:N==="neutral0"?"neutral150":void 0,hasRadius:!0,shrink:0,width:2}),value:g,textValue:j,children:j},g)})}),(0,s.jsx)(H.o,{}),(0,s.jsx)(V.Q,{})]})}),(0,s.jsxs)(v.L.Root,{isOpen:y==="workflow",onClose:()=>c(null),children:[(0,s.jsx)(v.L.Title,{children:e({id:"content-manager.reviewWorkflows.workflows.limit.title",defaultMessage:"You\u2019ve reached the limit of workflows in your plan"})}),(0,s.jsx)(v.L.Body,{children:e({id:"content-manager.reviewWorkflows.workflows.limit.body",defaultMessage:"Delete a workflow or contact Sales to enable more workflows."})})]}),(0,s.jsxs)(v.L.Root,{isOpen:y==="stage",onClose:()=>c(null),children:[(0,s.jsx)(v.L.Title,{children:e({id:"content-manager.reviewWorkflows.stages.limit.title",defaultMessage:"You have reached the limit of stages for this workflow in your plan"})}),(0,s.jsx)(v.L.Body,{children:e({id:"content-manager.reviewWorkflows.stages.limit.body",defaultMessage:"Try deleting some stages or contact Sales to enable more stages."})})]})]})},k=()=>{const{isCreatingEntry:_,layout:E}=(0,a.O_)(),D=E?.options?.reviewWorkflows??!1;return(0,s.jsxs)(r.I.Root,{children:[(0,s.jsx)(r.I.Title,{}),D&&!_&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Z,{}),(0,s.jsx)(J,{})]}),(0,s.jsx)(r.I.Body,{})]})}},8800:($,C,t)=>{t.d(C,{a:()=>R,g:()=>r});var s=t(58540),a=t(48132);function r(l){if(!l)return null;const u=Object.entries(s.g.colors).filter(([,m])=>m.toUpperCase()===l.toUpperCase()).reduce((m,[U])=>(a.S?.[U]&&(m=U),m),null);return u?{themeColorName:u,name:a.S[u]}:null}function R(){return Object.entries(a.S).map(([l,B])=>({hex:s.g.colors[l].toUpperCase(),name:B}))}},41864:($,C,t)=>{t.d(C,{A:()=>a,S:()=>s});const s="strapi_stage",a="strapi_assignee"}}]);
