"use strict";(self.webpackChunke_commerce_server=self.webpackChunke_commerce_server||[]).push([[9632,1360],{39632:(ee,j,e)=>{e.d(j,{ProtectedCreatePage:()=>F});var s=e(19968),D=e(71812),h=e(38188),R=e(9252),W=e(61360),U=e(54320),B=e(5240),y=e(91892),T=e(36196),L=e(20880),P=e(21424),p=e(62552),S=e(70516),b=e(48632),c=e(31812),$=e(18424),I=e(52540),N=e(21968),se=e(12132),te=e(85676),ne=e(35184),ae=e(99568),z=e(96556),oe=e(13192),re=e(30840),v=e(77784),K=e(79371),ie=e(67888),V=e(52600),G=e(95752),Z=e(37388),de=e(61840),le=e(49108),_e=e(44632),X=e(50840),Ee=e(20252),Y=e(86432),ce=e(22612),he=e(24808),u=e(24024),x=e(33656),f=e(43280),ge=e(79804),H=e(19632),Me=e(29576),J=e(61152),Oe=e(9589),Pe=e(45488),De=e(75516),me=e(17892),ue=e(31212),Ce=e(50040);const F=()=>{const w=(0,h.f)(R.s);return(0,s.jsx)(D.rF,{permissions:w.settings?.webhooks.create,children:(0,s.jsx)(W.E,{})})}},61360:(ee,j,e)=>{e.r(j),e.d(j,{E:()=>q,a:()=>k,b:()=>Be});var s=e(19968),D=e(62552),h=e(1560),R=e(87848),W=e(33560),U=e(40644),B=e(77328),y=e(95832),T=e(67752),L=e(55468),P=e(65080),p=e(72452),S=e(64712),b=e(59172),c=e(84664),$=e(23128),I=e(11360),N=e(49780),se=e(27688),te=e(66216),ne=e(12192),ae=e(37272),z=e(51772),oe=e(41868),re=e(8612),v=e(71812),K=e(48632),ie=e(39380),V=e(49008),G=e(38188),Z=e(50040),de=e(9252),le=e(46928),_e=e(45676),X=e(51224),Ee=e(24716),Y=e(18520),ce=e(69120),he=e(31952),u=e(31812),x=e(14632),f=e(52540),ge=e(43164),H=e(69372);const[Me,J]=(0,ge.G)("WebhookEvent"),Oe=({children:t})=>{const{formatMessage:n}=(0,x.c)(),{collectionTypes:a,isLoading:_}=(0,Z.u)(),o=D.useMemo(()=>a.some(r=>r.options?.draftAndPublish===!0),[a]),l=n({id:"Settings.webhooks.form.events",defaultMessage:"Events"});return(0,s.jsx)(Me,{isDraftAndPublish:o,children:(0,s.jsxs)(h.C,{direction:"column",alignItems:"stretch",gap:1,children:[(0,s.jsx)(R.u,{"aria-hidden":!0,children:l}),_&&(0,s.jsx)(W.c,{children:n({id:"Settings.webhooks.events.isLoading",defaultMessage:"Events loading"})}),(0,s.jsx)(Pe,{"aria-label":l,children:t})]})})},Pe=(0,H.default)(U.w)`
  tbody tr:nth-child(odd) {
    background: ${({theme:t})=>t.colors.neutral100};
  }

  thead th span {
    color: ${({theme:t})=>t.colors.neutral500};
  }

  td,
  th {
    padding-block-start: ${({theme:t})=>t.spaces[3]};
    padding-block-end: ${({theme:t})=>t.spaces[3]};
    width: 10%;
    vertical-align: middle;
    text-align: center;
  }

  tbody tr td:first-child {
    /**
     * Add padding to the start of the first column to avoid the checkbox appearing
     * too close to the edge of the table
     */
    padding-inline-start: ${({theme:t})=>t.spaces[2]};
  }
`,De=t=>{const n=[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"}];return t&&(n.push({id:"app.utils.publish",defaultMessage:"Publish"}),n.push({id:"app.utils.unpublish",defaultMessage:"Unpublish"})),n},me=({getHeaders:t=De})=>{const{isDraftAndPublish:n}=J("Headers"),{formatMessage:a}=(0,x.c)(),_=t(n);return(0,s.jsx)(B.Y,{children:(0,s.jsxs)(y._,{children:[(0,s.jsx)(T.d,{children:(0,s.jsx)(L.K,{children:a({id:"Settings.webhooks.event.select",defaultMessage:"Select event"})})}),_.map(o=>["app.utils.publish","app.utils.unpublish"].includes(o?.id??"")?(0,s.jsx)(T.d,{title:a({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"}),children:(0,s.jsx)(P.O,{variant:"sigma",textColor:"neutral600",children:a(o)})},o.id):(0,s.jsx)(T.d,{children:(0,s.jsx)(P.O,{variant:"sigma",textColor:"neutral600",children:a(o)})},o.id))]})})},ue=({providedEvents:t})=>{const{isDraftAndPublish:n}=J("Body"),a=t||Ce(n),{values:_,handleChange:o}=(0,u.Sq)(),l="events",r=_.events,O=[],m=r.reduce((d,i)=>{const g=i.split(".")[0];return d[g]||(d[g]=[]),d[g].push(i),d},{}),E=({target:{name:d,value:i}})=>{const g=new Set(r);i?g.add(d):g.delete(d),o({target:{name:l,value:Array.from(g)}})},C=({target:{name:d,value:i}})=>{const g=new Set(r);i?a[d].forEach(A=>{O.includes(A)||g.add(A)}):a[d].forEach(A=>g.delete(A)),o({target:{name:l,value:Array.from(g)}})};return(0,s.jsx)(p.A,{children:Object.entries(a).map(([d,i])=>(0,s.jsx)(F,{disabledEvents:O,name:d,events:i,inputValue:m[d],handleSelect:E,handleSelectAll:C},d))})},Ce=t=>{const n=["entry.create","entry.update","entry.delete"];return t&&n.push("entry.publish","entry.unpublish"),{entry:n,media:["media.create","media.update","media.delete"]}},F=({disabledEvents:t=[],name:n,events:a=[],inputValue:_=[],handleSelect:o,handleSelectAll:l})=>{const{formatMessage:r}=(0,x.c)(),O=a.filter(i=>!t.includes(i)),m=_.length>0,E=_.length===O.length,C=({target:{name:i}})=>{l({target:{name:i,value:!E}})},d=5;return(0,s.jsxs)(y._,{children:[(0,s.jsx)(T.w,{children:(0,s.jsx)(S.y,{indeterminate:m&&!E,"aria-label":r({id:"global.select-all-entries",defaultMessage:"Select all entries"}),name:n,onChange:C,value:E,children:w(n)})}),a.map(i=>(0,s.jsx)(T.w,{children:(0,s.jsx)(b.c,{disabled:t.includes(i),"aria-label":i,name:i,value:_.includes(i),onValueChange:g=>o({target:{name:i,value:g}})})},i)),a.length<d&&(0,s.jsx)(T.w,{colSpan:d-a.length})]})},w=t=>t.replace(/-/g," ").split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()).join(" "),k={Root:Oe,Headers:me,Body:ue,Row:F},Ae=()=>(0,s.jsxs)(k.Root,{children:[(0,s.jsx)(k.Headers,{}),(0,s.jsx)(k.Body,{})]}),Te=()=>{const{formatMessage:t}=(0,x.c)(),{values:n,errors:a}=(0,u.Sq)();return(0,s.jsxs)(h.C,{direction:"column",alignItems:"stretch",gap:1,children:[(0,s.jsx)(R.u,{children:t({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})}),(0,s.jsx)(c.k,{padding:8,background:"neutral100",hasRadius:!0,children:(0,s.jsx)(u.KE,{validateOnChange:!1,name:"headers",render:({push:_,remove:o})=>(0,s.jsxs)($.y,{gap:4,children:[n.headers.map((l,r)=>{const O=a.headers?.[r],m=typeof O=="object"?O.key:void 0,E=typeof O=="object"?O.value:void 0;return(0,s.jsxs)(D.Fragment,{children:[(0,s.jsx)(I.C,{col:6,children:(0,s.jsx)(u.IN,{as:Ie,name:`headers.${r}.key`,"aria-label":`row ${r+1} key`,label:t({id:"Settings.webhooks.key",defaultMessage:"Key"}),error:m})}),(0,s.jsx)(I.C,{col:6,children:(0,s.jsxs)(h.C,{alignItems:"flex-end",children:[(0,s.jsx)(c.k,{style:{flex:1},children:(0,s.jsx)(u.IN,{as:N.g,name:`headers.${r}.value`,"aria-label":`row ${r+1} value`,label:t({id:"Settings.webhooks.value",defaultMessage:"Value"}),error:E})}),(0,s.jsx)(h.C,{paddingLeft:2,style:{alignSelf:"center"},paddingTop:E?0:5,children:(0,s.jsx)(v.CA,{disabled:n.headers.length===1,onClick:()=>o(r),label:t({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:r+1})})})]})})]},`${r}.${l.key}`)}),(0,s.jsx)(I.C,{col:12,children:(0,s.jsx)(se.c,{type:"button",onClick:()=>{_({key:"",value:""})},startIcon:(0,s.jsx)(_e.c,{}),children:t({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"})})})]})})})]})},Ie=({name:t,onChange:n,value:a,..._})=>{const{values:{headers:o}}=(0,u.Sq)(),[l,r]=D.useState([...ve]);D.useEffect(()=>{const E=ve.filter(C=>!o?.some(d=>d.key!==a&&d.key===C));r(E)},[o,a]);const O=E=>{n({target:{name:t,value:E}})},m=E=>{r(C=>[...C,E]),O(E)};return(0,s.jsx)(te.cT,{..._,onClear:()=>O(""),onChange:O,onCreateOption:m,placeholder:"",value:a,children:l.map(E=>(0,s.jsx)(ne.m,{value:E,children:E},E))})},ve=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],xe=({isPending:t,onCancel:n,response:a})=>{const{statusCode:_,message:o}=a??{},{formatMessage:l}=(0,x.c)();return(0,s.jsx)(c.k,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0,children:(0,s.jsxs)($.y,{gap:4,style:{alignItems:"center"},children:[(0,s.jsx)(I.C,{col:3,children:(0,s.jsx)(P.O,{children:l({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"})})}),(0,s.jsx)(I.C,{col:3,children:(0,s.jsx)(je,{isPending:t,statusCode:_})}),(0,s.jsx)(I.C,{col:6,children:t?(0,s.jsx)(h.C,{justifyContent:"flex-end",children:(0,s.jsx)("button",{onClick:n,type:"button",children:(0,s.jsxs)(h.C,{gap:2,alignItems:"center",children:[(0,s.jsx)(P.O,{textColor:"neutral400",children:l({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})}),(0,s.jsx)(Q,{as:X.c,color:"neutral400"})]})})}):(0,s.jsx)(Re,{statusCode:_,message:o})})]})})},Q=H.default.svg(({theme:t,color:n})=>`
  width: ${12/16}rem;
  height: ${12/16}rem;


  ${n?(0,H.css)`
          path {
            fill: ${t.colors[n]};
          }
        `:""}
`),je=({isPending:t,statusCode:n})=>{const{formatMessage:a}=(0,x.c)();return t||!n?(0,s.jsxs)(h.C,{gap:2,alignItems:"center",children:[(0,s.jsx)(Q,{as:Ee.c}),(0,s.jsx)(P.O,{children:a({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"})})]}):n>=200&&n<300?(0,s.jsxs)(h.C,{gap:2,alignItems:"center",children:[(0,s.jsx)(Q,{as:Y.c,color:"success700"}),(0,s.jsx)(P.O,{children:a({id:"Settings.webhooks.trigger.success",defaultMessage:"success"})})]}):n>=300?(0,s.jsxs)(h.C,{gap:2,alignItems:"center",children:[(0,s.jsx)(Q,{as:X.c,color:"danger700"}),(0,s.jsxs)(P.O,{children:[a({id:"Settings.error",defaultMessage:"error"})," ",n]})]}):null},Re=({statusCode:t,message:n})=>{const{formatMessage:a}=(0,x.c)();return t?t>=200&&t<300?(0,s.jsx)(h.C,{justifyContent:"flex-end",children:(0,s.jsx)(P.O,{textColor:"neutral600",ellipsis:!0,children:a({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"})})}):t>=300?(0,s.jsx)(h.C,{justifyContent:"flex-end",children:(0,s.jsx)(h.C,{maxWidth:(0,v.W8)(250),justifyContent:"flex-end",title:n,children:(0,s.jsx)(P.O,{ellipsis:!0,textColor:"neutral600",children:n})})}):null:null},ye=({handleSubmit:t,triggerWebhook:n,isCreating:a,isTriggering:_,triggerResponse:o,data:l})=>{const{formatMessage:r}=(0,x.c)(),[O,m]=D.useState(!1),E=(0,G.j)(Ae,async()=>(await e.e(8592).then(e.bind(e,38592))).EventsTableEE),C=i=>Object.keys(i).length?Object.entries(i).map(([g,A])=>({key:g,value:A})):[{key:"",value:""}],d=(0,u.KO)({initialValues:{name:l?.name||"",url:l?.url||"",headers:C(l?.headers||{}),events:l?.events||[]},onSubmit(i,{resetForm:g,setSubmitting:A}){t(i),g({values:i}),A(!1)},validationSchema:Ue({formatMessage:r}),validateOnChange:!1,validateOnBlur:!1});return E?(0,s.jsx)(u.uo,{value:d,children:(0,s.jsxs)(v.QF,{children:[(0,s.jsx)(ae.a,{primaryAction:(0,s.jsxs)(h.C,{gap:2,children:[(0,s.jsx)(z.Z,{onClick:()=>{n(),m(!0)},variant:"tertiary",startIcon:(0,s.jsx)(ce.c,{}),disabled:a||_,size:"L",children:r({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})}),(0,s.jsx)(z.Z,{startIcon:(0,s.jsx)(Y.c,{}),type:"submit",size:"L",disabled:!d.dirty,loading:d.isSubmitting,children:r({id:"global.save",defaultMessage:"Save"})})]}),title:a?r({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):l?.name,navigationAction:(0,s.jsx)(le.c,{as:ie.NavLink,startIcon:(0,s.jsx)(he.c,{}),to:"/settings/webhooks",children:r({id:"global.back",defaultMessage:"Back"})})}),(0,s.jsx)(oe.S,{children:(0,s.jsxs)(h.C,{direction:"column",alignItems:"stretch",gap:4,children:[O&&(0,s.jsx)(xe,{isPending:_,response:o,onCancel:()=>m(!1)}),(0,s.jsx)(c.k,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0,children:(0,s.jsxs)(h.C,{direction:"column",alignItems:"stretch",gap:6,children:[(0,s.jsxs)($.y,{gap:6,children:[(0,s.jsx)(I.C,{col:6,children:(0,s.jsx)(u.IN,{as:N.g,name:"name",error:d.errors.name,label:r({id:"global.name",defaultMessage:"Name"}),required:!0})}),(0,s.jsx)(I.C,{col:12,children:(0,s.jsx)(u.IN,{as:N.g,name:"url",error:d.errors.url,label:r({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),required:!0})})]}),(0,s.jsx)(Te,{}),(0,s.jsx)(E,{})]})})]})})]})}):null},Le=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,We=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,Ue=({formatMessage:t})=>f.kt().shape({name:f.Qb().required(t({id:"Settings.webhooks.validation.name.required",defaultMessage:"Name is required"})).matches(Le,t({id:"Settings.webhooks.validation.name.regex",defaultMessage:"The name must start with a letter and only contain letters, numbers, spaces and underscores"})),url:f.Qb().required(t({id:"Settings.webhooks.validation.url.required",defaultMessage:"Url is required"})).matches(We,t({id:"Settings.webhooks.validation.url.regex",defaultMessage:"The value must be a valid Url"})),headers:f.Wk(n=>{const a=f.M$();if(n.length===1){const{key:_,value:o}=n[0];if(!_&&!o)return a}return a.of(f.kt().shape({key:f.Qb().required(t({id:"Settings.webhooks.validation.key",defaultMessage:"Key is required"})),value:f.Qb().required(t({id:"Settings.webhooks.validation.value",defaultMessage:"Value is required"}))}))}),events:f.M$()}),fe=t=>({...t,headers:t.headers.reduce((n,{key:a,value:_})=>(a!==""&&(n[a]=_),n),{})}),q=()=>{const n=(0,V.SU)("/settings/webhooks/:id")?.params.id,a=n==="create",{replace:_}=(0,V.Uz)(),o=(0,v.eo)(),{formatAPIError:l}=(0,v.An)(),{isLoading:r}=(0,Z.u)(),{put:O,get:m,post:E}=(0,v.Qn)(),{isLoading:C,data:d,error:i,refetch:g}=(0,K.useQuery)(["webhooks",n],async()=>{const{data:{data:M}}=await m(`/admin/webhooks/${n}`);return M},{enabled:!a});D.useEffect(()=>{i&&o({type:"warning",message:l(i)})},[i,o,l]);const{isLoading:A,data:Ke,mutate:pe}=(0,K.useMutation)(()=>E(`/admin/webhooks/${n}/trigger`).then(M=>M.data.data),{onError(M){o({type:"warning",message:l(M)})}}),Se=(0,K.useMutation)(M=>E("/admin/webhooks",M),{onSuccess({data:M}){o({type:"success",message:{id:"Settings.webhooks.created"}}),_(`/settings/webhooks/${M.data.id}`)},onError(M){o({type:"warning",message:l(M)})}}),be=(0,K.useMutation)(({id:M,body:Ne})=>O(`/admin/webhooks/${M}`,Ne),{onSuccess(){g(),o({type:"success",message:{id:"notification.form.success.fields"}})},onError(M){o({type:"warning",message:l(M)})}}),$e=async M=>{if(a){Se.mutate(fe(M));return}be.mutate({id:n,body:fe(M)})};return C||r?(0,s.jsx)(v.Wm,{}):(0,s.jsxs)(re.G,{children:[(0,s.jsx)(v.K8,{name:"Webhooks"}),(0,s.jsx)(ye,{data:d,handleSubmit:$e,triggerWebhook:pe,isCreating:a,isTriggering:A,triggerResponse:Ke})]})},Be=Object.freeze(Object.defineProperty({__proto__:null,EditPage:q,ProtectedEditPage:()=>{const t=(0,G.f)(de.s);return(0,s.jsx)(v.rF,{permissions:t.settings?.webhooks.update,children:(0,s.jsx)(q,{})})}},Symbol.toStringTag,{value:"Module"}))},50040:(ee,j,e)=>{e.d(j,{u:()=>W});var s=e(62552),D=e(71812),h=e(78164),R=e(48632);function W(){const{get:U}=(0,D.Qn)(),{formatAPIError:B}=(0,D.An)(),y=(0,D.eo)(),T=(0,R.useQueries)([{queryKey:["content-manager","components"],async queryFn(){const{data:{data:c}}=await U("/content-manager/components");return c},onError(c){c instanceof h.Uh&&y({type:"warning",message:B(c)})}},{queryKey:["content-manager","content-types"],async queryFn(){const{data:{data:c}}=await U("/content-manager/content-types");return c},onError(c){c instanceof h.Uh&&y({type:"warning",message:B(c)})}}]),[L,P]=T,p=L.isLoading||P.isLoading,S=s.useMemo(()=>(P?.data??[]).filter(c=>c.kind==="collectionType"&&c.isDisplayed),[P?.data]),b=s.useMemo(()=>(P?.data??[]).filter(c=>c.kind!=="collectionType"&&c.isDisplayed),[P?.data]);return{isLoading:p,components:s.useMemo(()=>L?.data??[],[L?.data]),collectionTypes:S,singleTypes:b}}}}]);
