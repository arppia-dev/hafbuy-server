"use strict";(self.webpackChunke_commerce_server=self.webpackChunke_commerce_server||[]).push([[4592],{49764:(W,v,t)=>{t.d(v,{F:()=>u});var s=t(19968),M=t(62552),p=t(84664),D=t(51772),m=t(71812),O=t(89456),g=t(14632);const u=({displayedFilters:T})=>{const[L,f]=M.useState(!1),{formatMessage:U}=(0,g.c)(),P=M.useRef(null),A=()=>{f(y=>!y)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(p.k,{paddingTop:1,paddingBottom:1,children:[(0,s.jsx)(D.Z,{variant:"tertiary",ref:P,startIcon:(0,s.jsx)(O.c,{}),onClick:A,size:"S",children:U({id:"app.utils.filters",defaultMessage:"Filters"})}),L&&(0,s.jsx)(m.SI,{displayedFilters:T,isVisible:L,onToggle:A,source:P})]}),(0,s.jsx)(m.aW,{filtersSchema:T})]})}},54592:(W,v,t)=>{t.d(v,{ProtectedAuditLogsListPage:()=>lt});var s=t(19968),M=t(58224),p=t(19112),D=t(28200),m=t(1560),O=t(33560),g=t(84664),u=t(65080),T=t(23128),L=t(90568),f=t(35560),U=t(69856),P=t(20592),A=t(62680),y=t(66216),x=t(12192),J=t(66040),N=t(41868),H=t(8612),X=t(37272),b=t(29296),_=t(71812),B=t(14632),$=t(70516),k=t(49764),V=t(9252),w=t(2408),q=t(47900),Q=t(48632),tt=t(27860),st=t(84564),j=t(33104),et=t(49008),at=t(38188),Et=t(62552),mt=t(17892),gt=t(31212),Mt=t(35184),Dt=t(85676),Ot=t(96556),Pt=t(54320),ct=t(5240),ut=t(91892),Lt=t(36196),ht=t(20880),Ct=t(21424),vt=t(31812),pt=t(18424),Tt=t(52540),At=t(21968),ft=t(12132),Ut=t(99568),yt=t(13192),Bt=t(30840),It=t(77784),Rt=t(79371),Kt=t(67888),Wt=t(52600),xt=t(95752),jt=t(37388),St=t(61840),Ft=t(49108),Nt=t(44632),$t=t(50840),Vt=t(20252),Qt=t(86432),zt=t(22612),Gt=t(24808),Yt=t(24024),Zt=t(33656),Jt=t(43280),Ht=t(79804),Xt=t(19632),bt=t(29576),kt=t(61152),wt=t(9589),qt=t(45488),ts=t(75516);const z=()=>{const{formatDate:e}=(0,B.c)();return l=>{const n=(0,tt.c)(l),r=e(n,{dateStyle:"long"}),i=e(n,{timeStyle:"medium",hourCycle:"h24"});return`${r}, ${i}`}},G={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},S=e=>G[e]||e,nt=({handleClose:e,logId:d})=>{const{get:l}=(0,_.Qn)(),n=(0,_.eo)(),r=async h=>{const{data:c}=await l(`/admin/audit-logs/${h}`);if(!c)throw new Error("Audit log not found");return c},{data:i,status:a}=(0,Q.useQuery)(["audit-log",d],()=>r(d),{onError(){n({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),e()}}),o=z(),E=i&&"date"in i?o(i.date):"";return(0,s.jsxs)(M.E,{onClose:e,labelledBy:"title",children:[(0,s.jsx)(p.k,{children:(0,s.jsx)(w.M,{label:E,id:"title",children:(0,s.jsx)(q.i,{isCurrent:!0,children:E})})}),(0,s.jsx)(D.a,{children:(0,s.jsx)(it,{status:a,data:i,formattedDate:E})})]})},it=({status:e,data:d,formattedDate:l})=>{const{formatMessage:n}=(0,B.c)();if(e==="loading")return(0,s.jsx)(m.C,{padding:7,justifyContent:"center",alignItems:"center",children:(0,s.jsx)(O.c,{children:"Loading content..."})});const{action:r,user:i,payload:a}=d;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.k,{marginBottom:3,children:(0,s.jsx)(u.O,{variant:"delta",id:"title",children:n({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"})})}),(0,s.jsxs)(T.y,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0,children:[(0,s.jsx)(I,{actionLabel:n({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:n({id:`Settings.permissions.auditLogs.${r}`,defaultMessage:S(r)},{model:a?.model})}),(0,s.jsx)(I,{actionLabel:n({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:l}),(0,s.jsx)(I,{actionLabel:n({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:i?.displayName||"-"}),(0,s.jsx)(I,{actionLabel:n({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:i?.id.toString()||"-"})]}),(0,s.jsx)(L.O,{value:JSON.stringify(a,null,2),disabled:!0,label:n({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})})]})},I=({actionLabel:e,actionName:d})=>(0,s.jsxs)(m.C,{direction:"column",alignItems:"baseline",gap:1,children:[(0,s.jsx)(u.O,{textColor:"neutral600",variant:"sigma",children:e}),(0,s.jsx)(u.O,{textColor:"neutral600",children:d})]}),ot=({pagination:e}={pagination:{page:1,pageCount:0,pageSize:50,total:0}})=>(0,s.jsx)(g.k,{paddingTop:4,children:(0,s.jsxs)(m.C,{alignItems:"flex-end",justifyContent:"space-between",children:[(0,s.jsx)(_.A7,{}),(0,s.jsx)(_.cZ,{pagination:e})]})}),F=({headers:e,rows:d,onOpenModal:l})=>{const{formatMessage:n}=(0,B.c)(),r=z(),i=({type:a,value:o,model:E})=>a==="date"?r(o):a==="action"?n({id:`Settings.permissions.auditLogs.${o}`,defaultMessage:S(o)},{model:E}):o||"-";return(0,s.jsx)(f.K,{children:d.map(a=>(0,s.jsxs)(U.Tr,{...(0,_.on)({fn:()=>l(a.id)}),children:[e?.map(({key:o,name:E,cellFormatter:h})=>{const c=a[E];return(0,s.jsx)(P.Td,{children:(0,s.jsx)(u.O,{textColor:"neutral800",children:i({type:o,value:h?h(c):c,model:a.payload?.model})})},o)}),(0,s.jsx)(P.Td,{..._.Ii,children:(0,s.jsx)(m.C,{justifyContent:"end",children:(0,s.jsx)(A.w,{onClick:()=>l(a.id),"aria-label":n({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${a.action} action`}),noBorder:!0,icon:(0,s.jsx)(st.c,{})})})})]},a.id))})};F.defaultProps={rows:[]},F.propTypes={headers:j.array.isRequired,rows:j.array,onOpenModal:j.func.isRequired};const dt=({canReadAuditLogs:e,canReadUsers:d})=>{const{get:l}=(0,_.Qn)(),{search:n}=(0,et.IT)(),r=(0,_.eo)(),[{query:i}]=(0,_.WK)(),a={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:C=>r({type:"warning",message:C.message})},{users:o,isError:E,isLoading:h}=(0,at.g)({},{...a,enabled:d,staleTime:2*(1e3*60)}),{data:c,isLoading:R,isError:K}=(0,Q.useQuery)(["auditLogs",n],async()=>{const{data:C}=await l("/admin/audit-logs",{params:i});return C},{...a,enabled:e});return{auditLogs:c,users:o,isLoading:h||R,hasError:K||E}},Y=({value:e,options:d,onChange:l}={value:void 0})=>{const{formatMessage:n}=(0,B.c)(),r=n({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return(0,s.jsx)(y.k1,{"aria-label":r,value:e,onChange:l,children:d?.map(({label:i,customValue:a})=>(0,s.jsx)(x.m,{value:a,children:i},a))})},Z=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}],rt=({formatMessage:e,users:d,canReadUsers:l})=>{const n=Object.keys(G).map(i=>({label:e({id:`Settings.permissions.auditLogs.${i}`,defaultMessage:S(i)},{model:void 0}),customValue:i})),r=[{name:"action",metadatas:{customOperators:Z,label:e({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),customInput:Y,options:n},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:e({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(l&&d){const i=o=>o.username?o.username:o.firstname&&o.lastname?e({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:o.firstname,lastname:o.lastname}):o.email,a=d.map(o=>({label:i(o),customValue:o.id.toString()}));return[...r,{name:"user",metadatas:{customOperators:Z,label:e({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:a,customInput:Y},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return r},_t=()=>{const{formatMessage:e}=(0,B.c)(),d=(0,$.w1)(V.s),{allowedActions:{canRead:l,canReadUsers:n}}=(0,_.aU)({...d.settings?.auditLogs,readUsers:d.settings?.users.read||[]}),[{query:r},i]=(0,_.WK)(),{auditLogs:a,users:o,isLoading:E,hasError:h}=dt({canReadAuditLogs:l,canReadUsers:n});(0,_.G0)();const c=rt({formatMessage:e,users:o,canReadUsers:n}),R=e({id:"global.auditLogs",defaultMessage:"Audit Logs"}),K=[{name:"action",key:"action",metadatas:{label:e({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),sortable:!0}},{name:"date",key:"date",metadatas:{label:e({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),sortable:!0}},{key:"user",name:"user",metadatas:{label:e({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),sortable:!1},cellFormatter:C=>C?C.displayName:""}];return h?(0,s.jsx)(J._,{children:(0,s.jsx)(N.S,{children:(0,s.jsx)(g.k,{paddingTop:8,children:(0,s.jsx)(_.wF,{})})})}):(0,s.jsxs)(H.G,{"aria-busy":E,children:[(0,s.jsx)(_.K8,{name:R}),(0,s.jsx)(X.a,{title:R,subtitle:e({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),(0,s.jsx)(b.U,{startActions:(0,s.jsx)(k.F,{displayedFilters:c})}),(0,s.jsxs)(N.S,{children:[(0,s.jsx)(_.AL,{contentType:"Audit logs",headers:K,rows:a?.results||[],withBulkActions:!0,isLoading:E,children:(0,s.jsx)(F,{headers:K,rows:a?.results||[],onOpenModal:C=>i({id:`${C}`})})}),a?.pagination&&(0,s.jsx)(ot,{pagination:a.pagination})]}),r?.id&&(0,s.jsx)(nt,{handleClose:()=>i({id:null},"remove"),logId:r.id})]})},lt=()=>{const e=(0,$.w1)(V.s);return(0,s.jsx)(_.rF,{permissions:e.settings?.auditLogs?.main,children:(0,s.jsx)(_t,{})})}},2408:(W,v,t)=>{t.d(v,{M:()=>T});var s=t(19968),M=t(62552),p=t(69372),D=t(84664),m=t(65080);const O=()=>(0,s.jsx)(D.k,{"aria-hidden":!0,paddingLeft:1,paddingRight:1,children:(0,s.jsx)(m.O,{variant:"pi",textColor:"neutral500",children:"/"})});O.displayName="Divider";var g=t(1560);const u=(0,p.default)(g.C)`
  // CrumbLinks do have padding-x, because they need to have a
  // interaction effect, which mis-aligns the breadcrumbs on the left.
  // This normalizes the behavior by moving the first item to left by
  // the same amount it has inner padding
  :first-child {
    margin-left: ${({theme:L})=>`calc(-1*${L.spaces[2]})`};
  }
`,T=({label:L,children:f,...U})=>{const P=M.Children.toArray(f);return(0,s.jsx)(D.k,{"aria-label":L,...U,children:(0,s.jsx)(u,{as:"ol",children:M.Children.map(P,(A,y)=>{const x=P.length>1&&y+1<P.length;return(0,s.jsxs)(g.C,{inline:!0,as:"li",children:[A,x&&(0,s.jsx)(O,{})]})})})})};T.displayName="Breadcrumbs"},47900:(W,v,t)=>{t.d(v,{i:()=>D});var s=t(19968),M=t(84664),p=t(65080);const D=({children:m,isCurrent:O=!1,...g})=>(0,s.jsx)(M.k,{paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1,children:(0,s.jsx)(p.O,{variant:"pi",textColor:"neutral800",fontWeight:O?"bold":"normal","aria-current":O,...g,children:m})});D.displayName="Crumb"}}]);
