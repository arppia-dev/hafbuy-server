"use strict";(self.webpackChunke_commerce_server=self.webpackChunke_commerce_server||[]).push([[274],{40274:($,g,s)=>{s.d(g,{ProtectedEditPage:()=>X});var t=s(19968),D=s(62552),E=s(84664),e=s(1560),A=s(65080),c=s(51772),I=s(23128),O=s(11360),C=s(49780),U=s(74928),T=s(8612),h=s(37272),d=s(41868),B=s(46928),_=s(71812),W=s(31952),K=s(78164),y=s(31812),i=s(14632),f=s(48632),R=s(49008),z=s(39380),x=s(52540),H=s(38188),J=s(68940),Z=s(9252),S=s(20672),ds=s(54320),rs=s(5240),es=s(91892),ls=s(36196),Ms=s(20880),Ps=s(21424),Ds=s(70516),Os=s(18424),ms=s(21968),vs=s(12132),As=s(85676),cs=s(35184),Cs=s(99568),hs=s(96556),Rs=s(13192),Ls=s(30840),gs=s(77784),Is=s(79371),Us=s(67888),Ts=s(52600),Bs=s(95752),Ws=s(37388),Ks=s(61840),fs=s(49108),us=s(44632),js=s(50840),ys=s(20252),xs=s(86432),Ss=s(22612),ps=s(24808),Ns=s(24024),Qs=s(33656),Fs=s(43280),$s=s(79804),zs=s(19632),Hs=s(29576),Js=s(61152),Zs=s(9589),Gs=s(45488),Vs=s(75516),Ys=s(17892),Xs=s(31212),bs=s(56781),ks=s(30680);const G=({disabled:r,role:n,values:m,errors:a,onChange:v,onBlur:L})=>{const{formatMessage:o}=(0,i.c)();return(0,t.jsx)(E.k,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsxs)(e.C,{direction:"column",alignItems:"stretch",gap:4,children:[(0,t.jsxs)(e.C,{justifyContent:"space-between",children:[(0,t.jsxs)(E.k,{children:[(0,t.jsx)(E.k,{children:(0,t.jsx)(A.O,{fontWeight:"bold",children:n?n.name:o({id:"global.details",defaultMessage:"Details"})})}),(0,t.jsx)(E.k,{children:(0,t.jsx)(A.O,{textColor:"neutral500",variant:"pi",children:n?n.description:o({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})})})]}),(0,t.jsx)(c.Z,{disabled:!0,variant:"secondary",children:o({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:n.usersCount})})]}),(0,t.jsxs)(I.y,{gap:4,children:[(0,t.jsx)(O.C,{col:6,children:(0,t.jsx)(C.g,{disabled:r,name:"name",error:a.name&&o({id:a.name}),label:o({id:"global.name",defaultMessage:"Name"}),onChange:v,onBlur:L,required:!0,value:m.name||""})}),(0,t.jsx)(O.C,{col:6,children:(0,t.jsx)(U.A,{disabled:r,label:o({id:"global.description",defaultMessage:"Description"}),id:"description",error:a.name&&o({id:a.name}),onChange:v,onBlur:L,children:m.description||""})})]})]})})},V=x.kt().shape({name:x.Qb().required(_.aO.required)}),Y=()=>{const r=(0,_.eo)(),{formatMessage:n}=(0,i.c)(),a=(0,R.SU)("/settings/roles/:id")?.params.id,{put:v,get:L}=(0,_.Qn)(),[o,p]=D.useState(!1),u=D.useRef(null),{lockApp:b,unlockApp:k}=(0,_.H6)(),{trackUsage:w}=(0,_.m4)(),{formatAPIError:q}=(0,_.An)(),{isLoading:ss,data:N}=(0,f.useQuery)(["permissions",a],async()=>{const{data:{data:M}}=await L("/admin/permissions",{params:{role:a}});return M},{cacheTime:0}),{roles:ts,isLoading:Q,refetch:as}=(0,J.u)({id:a},{cacheTime:0}),l=ts[0]??{},{permissions:_s,isLoading:ns}=(0,S.u)({id:a??null},{cacheTime:0}),os=async M=>{try{b?.(),p(!0);const{permissionsToSend:P,didUpdateConditions:j}=u.current?.getPermissions()??{};await v(`/admin/roles/${a}`,M),l.code!=="strapi-super-admin"&&(await v(`/admin/roles/${a}/permissions`,{permissions:P}),j&&w("didUpdateConditions")),u.current?.setFormAfterSubmit(),await as(),r({type:"success",message:{id:"notification.success.saved"}})}catch(P){P instanceof K.Uh&&r({type:"warning",message:q(P)})}finally{p(!1),k?.()}},F=!Q&&l.code==="strapi-super-admin";return(0,t.jsxs)(T.G,{children:[(0,t.jsx)(_.K8,{name:"Roles"}),(0,t.jsx)(y.QJ,{enableReinitialize:!0,initialValues:{name:l.name??"",description:l.description??""},onSubmit:os,validationSchema:V,validateOnChange:!1,children:({handleSubmit:M,values:P,errors:j,handleChange:Es,handleBlur:is})=>(0,t.jsxs)("form",{onSubmit:M,children:[(0,t.jsx)(h.a,{primaryAction:(0,t.jsx)(e.C,{gap:2,children:(0,t.jsx)(c.Z,{type:"submit",disabled:l.code==="strapi-super-admin",onClick:M,loading:o,size:"L",children:n({id:"global.save",defaultMessage:"Save"})})}),title:n({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:n({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:(0,t.jsx)(B.c,{as:z.NavLink,startIcon:(0,t.jsx)(W.c,{}),to:"/settings/roles",children:n({id:"global.back",defaultMessage:"Back"})})}),(0,t.jsx)(d.S,{children:(0,t.jsxs)(e.C,{direction:"column",alignItems:"stretch",gap:6,children:[(0,t.jsx)(G,{disabled:F,errors:j,values:P,onChange:Es,onBlur:is,role:l}),!ss&&!Q&&!ns&&N?(0,t.jsx)(E.k,{shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)(S.P,{isFormDisabled:F,permissions:_s,ref:u,layout:N})}):(0,t.jsx)(E.k,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)(_.Wm,{})})]})})]})})]})},X=()=>{const r=(0,H.f)(Z.s),{isLoading:n,allowedActions:{canRead:m,canUpdate:a}}=(0,_.aU)(r.settings?.roles);return n?(0,t.jsx)(_.Wm,{}):!m&&!a?(0,t.jsx)(R.YJ,{to:"/"}):(0,t.jsx)(Y,{})}},68940:($,g,s)=>{s.d(g,{u:()=>A});var t=s(62552),D=s(71812),E=s(14632),e=s(48632);const A=(c={},I={})=>{const{id:O="",...C}=c,{get:U}=(0,D.Qn)(),{locale:T}=(0,E.c)(),h=(0,D.In)(T,{sensitivity:"base"}),{data:d,error:B,isError:_,isLoading:W,refetch:K}=(0,e.useQuery)(["roles",O,C],async()=>{const{data:i}=await U(`/admin/roles/${O??""}`,{params:C});return i},I);return{roles:t.useMemo(()=>{let i=[];return d&&(Array.isArray(d.data)?i=d.data:i=[d.data]),[...i].sort((f,R)=>h.compare(f.name,R.name))},[d,h]),error:B,isError:_,isLoading:W,refetch:K}}}}]);
